<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OPL3 Direct Access Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      margin-top: 0;
      color: #333;
    }
    .test-section {
      margin: 2rem 0;
      padding: 1rem;
      background: #f9f9f9;
      border-left: 4px solid #0066cc;
      border-radius: 4px;
    }
    .test-section h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #0066cc;
    }
    .status {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 0.5rem;
    }
    .status.pending {
      background: #ffeaa7;
      color: #856404;
    }
    .status.running {
      background: #74b9ff;
      color: #004085;
    }
    .status.success {
      background: #55efc4;
      color: #155724;
    }
    .status.error {
      background: #ff7675;
      color: #721c24;
    }
    button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover {
      background: #0052a3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.9rem;
      line-height: 1.5;
    }
    .log-output {
      max-height: 400px;
      overflow-y: auto;
    }
    .summary {
      background: #e8f4f8;
      padding: 1rem;
      border-radius: 4px;
      margin: 1rem 0;
    }
    .summary h3 {
      margin-top: 0;
      color: #0066cc;
    }
    .result-list {
      list-style: none;
      padding: 0;
    }
    .result-list li {
      padding: 0.5rem;
      margin: 0.5rem 0;
      background: white;
      border-radius: 4px;
    }
    .result-list li::before {
      margin-right: 0.5rem;
      font-weight: bold;
    }
    .result-list li.pass::before {
      content: "‚úÖ";
    }
    .result-list li.fail::before {
      content: "‚ùå";
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéµ OPL3 Direct Access Test</h1>

    <p><strong>Purpose:</strong> Test if we can create and use an OPL3 chip instance directly in the main thread (outside AudioWorklet).</p>

    <p><strong>Why this matters:</strong> If this works, we can generate WAV files by creating a separate OPL3 instance, which is much simpler than trying to capture samples from the AudioWorklet.</p>

    <div class="test-section">
      <h2>Test Status: <span id="overallStatus" class="status pending">Not Started</span></h2>
      <button id="runTestBtn" onclick="runTests()">Run Tests</button>
    </div>

    <div class="summary" id="summary" style="display: none;">
      <h3>Test Results Summary</h3>
      <ul class="result-list" id="resultsList"></ul>
    </div>

    <div class="test-section">
      <h2>Console Output</h2>
      <div class="log-output">
        <pre id="consoleOutput">Waiting to run tests...</pre>
      </div>
    </div>

    <div class="test-section">
      <h2>What We're Testing</h2>
      <ol>
        <li><strong>Load OPL3 Library:</strong> Fetch and evaluate the OPL3 browser bundle</li>
        <li><strong>Create Chip Instance:</strong> Instantiate <code>new OPL3.OPL3()</code></li>
        <li><strong>Initialize OPL3 Mode:</strong> Enable OPL3 mode (register 0x105)</li>
        <li><strong>Load Simple Patch:</strong> Program a basic piano sound</li>
        <li><strong>Trigger Note:</strong> Play middle C (MIDI 60)</li>
        <li><strong>Generate Samples:</strong> Read 1000 samples from chip</li>
        <li><strong>Verify Audio:</strong> Check that samples are non-zero (actual sound)</li>
      </ol>
    </div>

    <div class="test-section">
      <h2>Expected Outcome</h2>
      <p><strong>‚úÖ Success:</strong> All tests pass, samples are non-zero</p>
      <p><strong>Result:</strong> We can use this approach for WAV export!</p>
      <br>
      <p><strong>‚ùå Failure:</strong> Can't create instance or samples are silent</p>
      <p><strong>Result:</strong> We'll need to use AudioWorklet recording approach</p>
    </div>
  </div>

  <script type="module" src="/features/export-audio/test-opl3-direct-access.ts"></script>
</body>
</html>
